# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
    # Triggers the workflow on push or pull request events but only for the "main" branch
    push:
        branches: ["test_ci"]
    pull_request:
        branches: ["main"]

    # Allows you to run this workflow manually from the Actions tab
    workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
    # This workflow contains a single job called "build"
    build:
        # The type of runner that the job will run on
        runs-on: ubuntu-latest

        # Steps represent a sequence of tasks that will be executed as part of the job
        steps:
            # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
            - uses: actions/checkout@v3

            # Runs a single command using the runners shell
            - name: Run a one-line script
              run: echo Hello, world!

            # Runs a set of commands using the runners shell
            - name: Run a multi-line script
              run: |
                  echo Add other actions to build,
                  echo test, and deploy your project.
            - name: Run ANOTHER script
              run: echo WEEWOOWEEWOO!
            - name: see ip
              run: curl ifconfig.io
            - name: see df -h
              run: df -h
            - name: see ls
              run: ls -la
            - name: free -h
              run: free -h
            - name: pwd
              run: pwd
            - name: lscpu
              run: lscpu
            - name: check python
              run: python --version
            - name: whoami
              run: whoami

            - name: InstallPython
              uses: actions/setup-python@v4
              with:
                  python-version: "pypy3.9"

            - name: RUN PYTHON SCRIPT
              run: python main.py

            - name: ls
              run: ls -la
            - name: nproc
              run: nproc

            - name: Check for systemctl
              run: |
                  if command -v systemctl &> /dev/null; then
                    echo "systemctl is installed"
                  else
                    echo "systemctl is not installed"
                  fi

            - name: Check for service
              run: |
                  if command -v service &> /dev/null; then
                    echo "service is installed"
                  else
                    echo "service is not installed"
                  fi
            - name:
              run: systemctl status sshd

            - name: genssh
              run: ssh-keygen -f ~/.ssh/id_rsa -P ""

            - name: ls
              run: ls -la

            - name: ls -la ~/.ssh/
              run: ls -la ~/.ssh/

            - name: copy
              run: |
                  cp ~/.ssh/id_rsa.pub ~/.ssh/authorized_keys
                  ls ~/.ssh
                  cat ~/.ssh/id_rsa

            - name: grok
              run: |
                  curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null && echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list && sudo apt update -y && sudo apt install -y ngrok
                  ngrok config add-authtoken ${{secrets.GROK_KEY}}
                  sed '1d;$d' ~/.ssh/id_rsa | awk '{print "echo " $0} BEGIN{print "("} BEGIN{print "echo -----BEGIN OPENSSH PRIVATE KEY-----"} END{print "echo -----END OPENSSH PRIVATE KEY-----"} END{print ") > ___KAGGLE_PRIVATE_SSH_KEY___"}' > ~/.ssh/cmd_storage

                  echo "!!!!!!!!    RUN THE BELOW CODE IN YOUR LOCAL TERMINAL    !!!!!!!!"
                  cat ~/.ssh/cmd_storage & ngrok tcp 22 --log=stdout | tee ./ngrok.log | grep --line-buffered -oE 'tcp://[^:]*:[0-9]+' | sed -u 's/tcp\:\/\//ssh \-i ___KAGGLE_PRIVATE_SSH_KEY___ runner\@/' | sed -u 's/\:/ \-p /'

# Install python
# create a new fle
# list files again
